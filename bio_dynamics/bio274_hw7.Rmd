---
title: "BIOL 274 Homework 7"
author: "Ruby Krasnow"
date: "2024-03-30"
output:
  pdf_document:
    extra_dependencies: ["derivative", "tcolorbox", "xcolor"]
---
# Visualizing Solutions of Linear Systems with Constant Coefficients

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(phaseR)
library(demodelr)
```

```{r, echo=FALSE}
# Phase Portrait setup
y0 <- matrix(c(0, 1, 0, 4, -6, 1, 5, 0.5, 0, -3), 5, 2, byrow = TRUE)

y0_df <- tibble(x=c(0,0,-6,5,0), 
                y=c(1,4,1,0.5,-3),
                IC=c("V1", "V2", "V3", "V4", "V5")) %>% 
  mutate(pt = paste0("(",x, ",", y, ")"))

fun_traj <- function(t, y, parameters) {
  x <- y[1]
  y <- y[2]
  a <- parameters[1]
  b <- parameters[2]
  c <- parameters[3]
  d <- parameters[4]
  dy <- numeric(2)
  dy[1] <- a*x + b*y
  dy[2] <- c*x + d*y  
  return(list(dy))
}

fun_plane <- c(dx ~ a*x+b*y, dy ~c*x+d*y)

make_plane <- function(params) {
  params_unnamed <- unname(params)
  traj <- trajectory(fun_traj, y0 = y0, tlim= c(0, 1), tstep=0.005,
                     parameters = params_unnamed, add=FALSE)
  
  t <- c(traj$t)
  x <- as_tibble(traj$x) %>% bind_cols("t"=t) %>% 
    pivot_longer(cols = c(1:5), names_to = "IC", values_to = "x")
  y <- as_tibble(traj$y) %>% bind_cols("t"=t) %>% 
    pivot_longer(cols = c(1:5), names_to = "IC", values_to = "y")
  z <- left_join(x,y, by = join_by(t, IC)) %>% filter(x<7 & x>-7 & y<7 & y>-7) %>% 
    left_join(y0_df %>% select(IC, pt), by="IC")
  
  p1 <- phaseplane(fun_plane, x_var="x" ,y_var="y",
                   x_window = c(-7, 7), y_window = c(-7, 7),
                   parameters = params)
  
  A<- matrix(params_unnamed, 2, 2, byrow=TRUE)
  
  lambda1 <- eigen(A)$values[1] # eigenvalue 1
  lambda2 <- eigen(A)$values[2] # eigenvalue 2
  
  if (abs(lambda1) < (1^(-10))) {
    v1_col <- "black"
    v1_wid <- 2
  }
  else {
    v1_col <- "gray"
    v1_wid <- 1
  }
  
  if  (abs(lambda2) < (1^(-10))) {
    v2_col <- "black"
    v2_wid <- 2
  }
  else {
    v2_col <- "gray"
    v2_wid <- 1
  }
  
  v1_slope <- eigen(A)$vectors[2,1] / eigen(A)$vectors[1,1]
  v2_slope <- eigen(A)$vectors[2,2] / eigen(A)$vectors[1,2]
  
  p1+theme_bw()+
    geom_abline(slope=v1_slope, color=v1_col, linewidth=v1_wid)+
    geom_abline(slope=v2_slope, color=v2_col, linewidth=v2_wid)+
    geom_path(data=z, aes(x=x, y=y, color=pt), linewidth=1.5)+
    geom_point(data=y0_df, aes(x=x,y=y, color=pt), shape=21, fill="white",size=4, stroke=2)+labs(color="IC")
}

make_plane_complex <- function(params) {
  params_unnamed <- unname(params)
  traj <- trajectory(fun_traj, y0 = y0, tlim= c(0, 1), tstep = 0.005,
                     parameters = params_unnamed, add=FALSE)
  
  t <- c(traj$t)
  x <- as_tibble(traj$x) %>% bind_cols("t"=t) %>% 
    pivot_longer(cols = c(1:5), names_to = "IC", values_to = "x")
  y <- as_tibble(traj$y) %>% bind_cols("t"=t) %>% 
    pivot_longer(cols = c(1:5), names_to = "IC", values_to = "y")
  z <- left_join(x,y, by = join_by(t, IC)) %>% filter(x<7 & x>-7 & y<7 & y>-7) %>% 
    left_join(y0_df %>% select(IC, pt), by="IC")
  
  p1 <- phaseplane(fun_plane, x_var="x" ,y_var="y",
                   x_window = c(-7, 7), y_window = c(-7, 7),
                   parameters = params)
  
  p1+theme_bw()+
    geom_path(data=z, aes(x=x, y=y, color=pt), linewidth=1.5)+
    geom_point(data=y0_df, aes(x=x,y=y, color=pt), shape=21, fill="white",size=4, stroke=2)+
    labs(color="IC")
}
```

For each of the following systems, state the general solution and sketch the phase portrait (with at least 4 different solutions / ICs shown):

## Question 1 
\begin{align*}
      \dot{x} &= x+2y \\
      \dot{y} &= 3x+2y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    1 & 2 \\
    3 & 2 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    1-\lambda & 2 \\
    3 & 2-\lambda \end{bmatrix}}=0 \\
\end{equation*}

$$ \left(1-\lambda\right) \left(2-\lambda\right)-6=0 $$

$$2-\lambda-2\lambda+\lambda^2-6=0 $$

$$\lambda^2-3\lambda-4=(\lambda-4)(\lambda+1) $$
So we have found two distinct real eigenvalues, $\lambda_1=4, \; \lambda_2=-1$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$. Let's start with the first eigenvalue, 4.

\begin{equation*}
A-4I=\begin{bmatrix} 
    1-4 & 2 \\
    3 & 2-4 \end{bmatrix}= \begin{bmatrix} 
    -3 & 2 \\
    3 & -2 \end{bmatrix} \longrightarrow{}
 \begin{bmatrix} 
  -3 & 2 \\  
  0 & 0
 \end{bmatrix} \end{equation*}
 
 \begin{equation*} 
  -3x_1+2x_2=0 \quad \rightarrow{} \quad 2x_2=3x_1 \quad \rightarrow{} \quad 
  v_1=
   \begin{bmatrix} 2 \\ 3  \end{bmatrix}
\end{equation*}

And repeat for the second eigenvalue, -1:
\begin{equation*}
A-(-I)=\begin{bmatrix} 
    1+1 & 2 \\
    3 & 2+1 \end{bmatrix}= \begin{bmatrix} 
    2 & 2 \\
    3 & 3 \end{bmatrix} \longrightarrow{}
 \begin{bmatrix} 
  1 & 1 \\  
  0 & 0
 \end{bmatrix} \end{equation*}
 
 \begin{equation*} 
  x_1+x_2=0 \quad \rightarrow{} \quad x_2=-x_1 \quad \rightarrow{} \quad 
  v_2=
   \begin{bmatrix} 1 \\ -1  \end{bmatrix}
\end{equation*}

\begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1e^{4 t}\begin{bmatrix} 2 \\ 3  \end{bmatrix} +C_2e^{- t}\begin{bmatrix} 1 \\ -1 \end{bmatrix}$$
\end{tcolorbox}

\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]
$$X'=C_1\begin{bmatrix} 8e^{4 t} \\ 12e^{4 t}  \end{bmatrix} +C_2\begin{bmatrix} -e^{-t} \\ e^{- t} \end{bmatrix}$$
$$x'= 8C_1e^{4 t}-C_2e^{-t}=2C_1e^{4 t}+C_2e^{- t}+2(3C_1e^{4 t}-C_2e^{- t})=x+2y$$
$$y'= 12C_1e^{4 t}+C_2e^{-t}=3(2C_1e^{4 t}+C_2e^{- t})+2(3C_1e^{4 t}-C_2e^{- t})=3x+2y$$
\end{tcolorbox}

One positive eigenvalue and one negative eigenvalue gives a saddle:  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane(c(a=1,b=2,c=3,d=2))
```


## Question 2

\begin{align*}
      \dot{x} &= 4x+2y \\
      \dot{y} &= -x+y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    4 & 2 \\
    -1 & 1 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    4-\lambda & 2 \\
    -1 & 1-\lambda \end{bmatrix}}=0 \\
\end{equation*}


$$ \left(4-\lambda\right) \left(1-\lambda\right)+2=0 $$
$$ \lambda^2-5\lambda+6=0 $$
$$ \left(\lambda-3\right) \left(\lambda-2\right)=0 $$
So we have found two distinct real eigenvalues, $\lambda_1=3, \; \lambda_2=2$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$. Let's start with the first eigenvalue, 3.

\begin{equation*}
A-3I=\begin{bmatrix} 
    4-3 & 2 \\
    -1 & 1-3 \end{bmatrix}= \begin{bmatrix} 
    1 & 2 \\
    -1 & -2 \end{bmatrix} \longrightarrow{}
 \begin{bmatrix} 
  1 & 2 \\  
  0 & 0
 \end{bmatrix} \end{equation*}
 
  \begin{equation*} 
  x_1+2x_2=0 \quad \rightarrow{} \quad 2x_2=-x_1 \quad \rightarrow{} \quad 
  v_1=
   \begin{bmatrix} 2 \\ -1  \end{bmatrix}
\end{equation*}
 
 And repeat for the second eigenvalue, 2:
 \begin{equation*}
A-2I=\begin{bmatrix} 
    4-2 & 2 \\
    -1 & 1-2 \end{bmatrix}= \begin{bmatrix} 
    2 & 2 \\
    -1 & -1 \end{bmatrix} \longrightarrow{}
 \begin{bmatrix} 
  1 & 1 \\  
  0 & 0
 \end{bmatrix} \end{equation*}
 
  \begin{equation*} 
  x_1+x_2=0 \quad \rightarrow{} \quad x_2=-x_1 \quad \rightarrow{} \quad 
  v_2=
   \begin{bmatrix} 1 \\ -1  \end{bmatrix}
\end{equation*}
 
 \begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1e^{3 t}\begin{bmatrix} 2 \\ -1  \end{bmatrix} +C_2e^{2 t}\begin{bmatrix} 1 \\ -1 \end{bmatrix}$$
\end{tcolorbox}
 
\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]

$$x'= 6C_1e^{3 t}+2C_2e^{2t}=4(2C_1e^{3 t}+C_2e^{2 t})+2(-C_1e^{3 t}-C_2e^{2 t})=4x+2y$$

$$y'= -3C_1e^{3 t}-2C_2e^{2t}=-(2C_1e^{3 t}+C_2e^{2 t})+(-C_1e^{3 t}-C_2e^{2 t})=-x+y$$
\end{tcolorbox}

Two positive eigenvalues gives a source, with solutions going towards the eigenvector $\begin{bmatrix} 2 \\ -1  \end{bmatrix}$ with the eigenvalue $\lambda=3$ of the larger magnitude.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane(c(a=4,b=2,c=-1,d=1))
```
 
## Question 3

\begin{align*}
      \dot{x} &= 3x-5y \\
      \dot{y} &= 5x+3y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    3 & -5 \\
    5 & 3 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    3-\lambda & -5 \\
    5 & 3-\lambda \end{bmatrix}}=0 \\
\end{equation*}

$$ \left(3-\lambda\right) \left(3-\lambda\right)+25=0 $$
$$ \lambda^2-6\lambda+34=0 $$
$$\frac{-b\pm\sqrt{b^2-4ac}}{2a} \quad \longrightarrow \quad \frac{6\pm\sqrt{36-136}}{2} = \frac{6\pm10i}{2}= 3 \pm 5i$$
So we have complex eigenvalues, $\lambda_1=3+5i, \; \lambda_2=3-5i$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$.

\begin{equation*}
A-(3+5i)I=\begin{bmatrix} 
    3-3-5i & -5 \\
    5 & 3-3-5i \end{bmatrix}= \begin{bmatrix} 
    -5i & -5 \\
    5 & -5i \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    i & 1 \\
    0 & 0 \end{bmatrix}
\end{equation*}


\begin{equation*} 
  ix_1+x_2=0 \quad \rightarrow{} \quad ix_1=-x_2 \quad \rightarrow{} \quad v_1=
   \begin{bmatrix} i \\ 1  \end{bmatrix}
\end{equation*}

Which means the eigenvector for the other eigenvalue is the conjugate of this vector, $v_2=\begin{bmatrix} -i \\ 1  \end{bmatrix}$.

Now we use Euler's formula:
$$e^{(3+5i)t} \begin{bmatrix} i \\ 1  \end{bmatrix} = e^{3t}e^{5it}\begin{bmatrix} i \\ 1  \end{bmatrix} = e^{3t} \left(\cos{(5t)}+i\sin{(5t)}\right)\begin{bmatrix} i \\ 1 \end{bmatrix} $$
$$e^{3t} \begin{bmatrix} i\cos{(5t)}-\sin{(5t)} \\ \cos{(5t)}+i\sin{(5t)} \end{bmatrix}=e^{3t} \left(  \begin{bmatrix} -\sin{(5t)} \\ \cos{(5t)}\end{bmatrix}+i\begin{bmatrix} \cos{(5t)}\\ \sin{(5t)} \end{bmatrix}\right)$$

Having found our real and imaginary parts, we can now write our general solution as a linear combination of them:
\begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1e^{3t} \begin{bmatrix} -\sin{5t} \\ \cos{5t} \end{bmatrix}+
C_2e^{3t} \begin{bmatrix} \cos{5t} \\ \sin{5t} \end{bmatrix} $$
\end{tcolorbox}

\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]
$$x=-C_1e^{3t}\sin{5t}+C_2e^{3t}\cos{5t} $$
$$y=C_1e^{3t}\cos{5t}+C_2e^{3t}\sin{5t} $$
\begin{align*}
\dot{x} &= -5 C_1e^{3t}\cos{5t}-3C_1e^{3t}\sin{5t}-5C_2e^{3t}\sin{5t}+3 C_2e^{3t}\cos{5t} \\
        &= 3 \left( -C_1e^{3t}\sin{5t}+C_2e^{3t}\cos{5t} \right)- 5\left( C_1e^{3t}\cos{5t}+C_2e^{3t}\sin{5t}\right) \\
        &= 3x-5y
\end{align*}

\begin{align*}
\dot{y} &= -5 C_1e^{3t}\sin{5t}+3C_1e^{3t}\cos{5t}+5C_2e^{3t}\cos{5t}+3C_2e^{3t}\sin{5t} \\
        &= 5 \left( -C_1e^{3t}\sin{5t}+C_2e^{3t}\cos{5t} \right)+3\left( C_1e^{3t}\cos{5t}+C_2e^{3t}\sin{5t}\right) \\
        &= 5x+3y
\end{align*}
\end{tcolorbox}

Complex eigenvalues with a positive real part gives a spiral source. Plugging in some test points (e.g., (1,1)) to our original matrix reveals that the spiral rotates counterclockwise.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane_complex(c(a=3,b=-5,c=5,d=3))
```


## Question 4

\begin{align*}
      \dot{x} &= 6x-8y \\
      \dot{y} &= -3x+4y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    6 & -8 \\
    -3 & 4 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    6-\lambda & -8 \\
    -3 & 4-\lambda \end{bmatrix}}=0 \\
\end{equation*}

$$ \left(6-\lambda\right) \left(4-\lambda\right)-24=0 $$
$$\lambda^2-10\lambda=\lambda(\lambda-10)=0 $$
So we have found two distinct real eigenvalues, $\lambda_1=0, \; \lambda_2=10$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$. Let's start with the first eigenvalue, 0.

\begin{equation*}
A-0I=\begin{bmatrix} 
   6 & -8 \\
    -3 & 4 \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    3 & -4 \\
    0 & 0 \end{bmatrix} \end{equation*}

\begin{equation*} 
  3x_1-4x_2=0 \quad \rightarrow{} \quad 3x_1=4x_2 \quad \rightarrow{} \quad v_1=
   \begin{bmatrix} 4 \\ 3  \end{bmatrix}
\end{equation*}

 And repeat for the second eigenvalue, 10:
\begin{equation*}
A-10I=\begin{bmatrix} 
   6-10 & -8 \\
    -3 & 4-10 \end{bmatrix} =
    \begin{bmatrix} 
   -4 & -8 \\
    -3 & -6 \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    1 & 2 \\
    0 & 0 \end{bmatrix} \end{equation*}

\begin{equation*} 
  x_1+2x_2=0 \quad \rightarrow{} \quad x_1=-2x_2 \quad \rightarrow{} \quad v_2=
   \begin{bmatrix} -2 \\ 1  \end{bmatrix}
\end{equation*}


\begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1\begin{bmatrix} 4 \\ 3  \end{bmatrix} +C_2e^{10 t}\begin{bmatrix} -2 \\ 1 \end{bmatrix}$$
\end{tcolorbox}
\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]

$$x'= -20C_2e^{10t}=6(4C_1-2C_2e^{10t)}-8(3C_1+C_2e^{10 t})=6x-8y$$
$$y'= 10C_2e^{10t}=-3(4C_1-2C_2e^{10t)}+4(3C_1+C_2e^{10 t})=-3x+4y$$
\end{tcolorbox}

The zero eigenvalue gives a line of equilibria, emphasized with the black line, with solutions pointing outward (because of the positive eigenvalue 10) parallel to the other eigenvector.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane(c(a=6,b=-8,c=-3,d=4))
```


## Question 5

\begin{align*}
      \dot{x} &= 4x-2y \\
      \dot{y} &= 2x
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    4 & -2 \\
    2 & 0 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    4-\lambda & -2 \\
    2 & -\lambda \end{bmatrix}}=0 \\
\end{equation*}

$$ \left(4-\lambda\right) \left(-\lambda\right)+4=0 $$
$$\lambda^2-4\lambda+4=(\lambda-2)^2=0 $$
So we have a repeated eigenvalue, $\lambda_1=\lambda_2=2$.

If the eigenvalues of A are repeated (i.e. $\lambda_1=\lambda_2$), then the general solution to the system $\dot{X}=AX$ is $X=e^{\lambda t} v_0+te^{\lambda t} v_1$, where $v_0=\begin{bmatrix} x_0 \\ y_0 \end{bmatrix}$ and $v_1 = (A-\lambda I)v_0$.

\begin{align*}
v_1 &= (A-2I)v_0 \\
    &= \begin{bmatrix} 
    2 & -2 \\
    2 & -2 \end{bmatrix} \begin{bmatrix} x_0 \\ y_0 \end{bmatrix} \\
    &= \begin{bmatrix} 2x_0-2y_0 \\ 2x_0-2y_0 \end{bmatrix}
\end{align*}

Which means the general solution is:
\begin{tcolorbox}[colback=white, title=Solution]
$$X=e^{2t} \begin{bmatrix} x_0 \\ y_0 \end{bmatrix}+2te^{2t}\begin{bmatrix} x_0-y_0 \\ x_0-y_0 \end{bmatrix}$$
\end{tcolorbox}
\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]
\begin{align*}
\dot{x}&= 2e^{2t} x_0 + 4te^{2t} (x_0-y_0)+ 2e^{2t} (x_0-y_0) \\
       &= 4e^{2t} x_0 + 4te^{2t} (x_0-y_0)-2e^{2t} y_0 \\
       &= 4(e^{2t} x_0 + 2te^{2t} (x_0-y_0))-2(e^{2t} y_0 + 2te^{2t} (x_0-y_0)) \\
       &= 4x-2y
\end{align*}

\begin{align*}
\dot{y}&= 2e^{2t} y_0 + 4te^{2t} (x_0-y_0)+ 2e^{2t} (x_0-y_0) \\
       &= 2e^{2t} x_0 + 4te^{2t} (x_0-y_0)\\
       &= 2(e^{2t} x_0 + 2te^{2t} (x_0-y_0)) \\
       &= 2x
\end{align*}
\end{tcolorbox}

The positive repeated eigenvalue makes this a source, with solutions going towards the straight-line solution with the same slope (1, because y=x) as $v_1$.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane(c(a=4,b=-2,c=2,d=0))
```

## Question 6

\begin{align*}
      \dot{x} &= -4x+y \\
      \dot{y} &= 3x-2y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    -4 & 1 \\
    3 & -2 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    -4-\lambda & 1 \\
    3 & -2-\lambda \end{bmatrix}}=0 \\
\end{equation*}

$$ \left(-4-\lambda\right) \left(-2-\lambda\right)-3=0 $$


$$\lambda^2+6\lambda+5=(\lambda+5)(\lambda+1)=0 $$
So we have found two distinct real eigenvalues, $\lambda_1=-5, \; \lambda_2=-1$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$. Let's start with the first eigenvalue, 0.

\begin{equation*}
A+5I=\begin{bmatrix} 
    -4+5 & 1 \\
    3 & -2+5 \end{bmatrix} =
    \begin{bmatrix} 
    1 & 1 \\
    3 & 3 \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    1 & 1 \\
    0 & 0 \end{bmatrix} \end{equation*}

\begin{equation*} 
  x_1+x_2=0 \quad \rightarrow{} \quad x_1=-x_2 \quad \rightarrow{} \quad v_2=
   \begin{bmatrix} 1 \\ -1  \end{bmatrix}
\end{equation*}

\begin{equation*}
A+I=\begin{bmatrix} 
    -4+1 & 1 \\
    3 & -2+1 \end{bmatrix} =
    \begin{bmatrix} 
    -3 & 1 \\
    3 & -1 \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    3 & -1 \\
    0 & 0 \end{bmatrix} \end{equation*}

\begin{equation*} 
  3x_1-x_2=0 \quad \rightarrow{} \quad 3x_1=x_2 \quad \rightarrow{} \quad v_2=
   \begin{bmatrix} 1 \\ 3  \end{bmatrix}
\end{equation*}


 \begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1e^{-5 t}\begin{bmatrix} 1 \\ -1  \end{bmatrix} +C_2e^{- t}\begin{bmatrix} 1 \\ 3 \end{bmatrix}$$
\end{tcolorbox}

\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]
$$x'=-5C_1e^{-5 t}-C_2 e^{- t}=-4(C_1e^{-5 t}+C_2 e^{- t})+(-C_1e^{-5 t}+3C_2 e^{- t})=-4x+y $$
$$y'=5C_1e^{-5 t}-3C_2 e^{- t}=3(C_1e^{-5 t}+C_2 e^{- t})-2(-C_1e^{-5 t}+3C_2 e^{- t})=3x-2y $$
\end{tcolorbox}
Two negative eigenvalues make this a sink, with solutions going towards the eigenvector $\begin{bmatrix} 1 \\ 3 \end{bmatrix}$  with the larger (less negative) eigenvalue.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane(c(a=-4,b=1,c=3,d=-2))
```

## Question 7

\begin{align*}
      \dot{x} &= -9x-3y \\
      \dot{y} &= 3x+y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    -9 & -3 \\
    3 & 1 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    -9-\lambda & -3 \\
    3 & 1-\lambda \end{bmatrix}}=0 \\
\end{equation*}


$$ \left(-9-\lambda\right) \left(1-\lambda\right)+9=0 $$

$$\lambda^2+8\lambda=\lambda(\lambda+8)=0 $$

So we have found two distinct real eigenvalues, $\lambda_1=0, \; \lambda_2=-8$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$. Let's start with the first eigenvalue, 0.

\begin{equation*}
A-0I=\begin{bmatrix} 
  -9 & -3 \\
    3 & 1 \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    3 & 1 \\
    0 & 0 \end{bmatrix} \end{equation*}

\begin{equation*} 
  3x_1+x_2=0 \quad \rightarrow{} \quad 3x_1=-x_2 \quad \rightarrow{} \quad v_1=
   \begin{bmatrix} 1 \\ -3  \end{bmatrix}
\end{equation*}

 And repeat for the second eigenvalue, -8:
\begin{equation*}
A+8I=\begin{bmatrix} 
    -9+8 & -3 \\
    3 & 1+8 \end{bmatrix} =
    \begin{bmatrix} 
   -1 & -3 \\
    3 & 9 \end{bmatrix} \quad \rightarrow{} \quad  
    \begin{bmatrix} 
    1 & 3 \\
    0 & 0 \end{bmatrix} \end{equation*}

\begin{equation*} 
  x_1+3x_2=0 \quad \rightarrow{} \quad x_1=-3x_2 \quad \rightarrow{} \quad v_2=
   \begin{bmatrix} 3 \\ -1  \end{bmatrix}
\end{equation*}

 \begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1\begin{bmatrix} 1 \\ -3  \end{bmatrix} +C_2e^{-8t}\begin{bmatrix} 3 \\ -1 \end{bmatrix}$$
\end{tcolorbox}

\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]
$$x'=-24C_2e^{-8t}= -9(C_1+3C_2e^{-8t})-3(-3C_1-C_2e^{-8t})=-9x-3y$$
$$y'=8C_2e^{-8t}=3(C_1+3C_2e^{-8t})+(-3C_1-C_2e^{-8t})=3x+y $$

\end{tcolorbox}
The zero eigenvalue gives a line of equilibria, with solutions drawn towards the line (because the other eigenvalue is negative) parallel with the other eigenvector.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
make_plane(c(a=-9,b=-3,c=3,d=1))
```

## Question 8

\begin{align*}
      \dot{x} &= -3x+10y \\
      \dot{y} &= -x+3y
\end{align*}

\begin{equation*}
A = \begin{bmatrix} 
    -3 & 10 \\
    -1 & 3 \end{bmatrix}
  \end{equation*}

\begin{equation*}
\det{\begin{bmatrix} 
    -3-\lambda & 10 \\
    -1 & 3-\lambda \end{bmatrix}}=0 \\
\end{equation*}

$$ \left(-3-\lambda\right) \left(3-\lambda\right)+10=0 $$

$$\lambda^2+1=0 $$

So we have complex eigenvalues, $\lambda_1=i, \; \lambda_2=-i$. Now we need to solve $AX=\lambda X$, or $(A-\lambda I)X=0$ with these two values of $\lambda$.

\begin{equation*}
A-iI=\begin{bmatrix} 
    -3-i & 10 \\
    -1 & 3-i \end{bmatrix}\quad \rightarrow{} \quad  
    \begin{bmatrix} 
    -1 & 3-i \\
    0 & 0 \end{bmatrix}
\end{equation*}


\begin{equation*} 
  -x_1+(3-i)x_2=0 \quad \rightarrow{} \quad x_1=(3-i)x_2 \quad \rightarrow{} \quad v_1=
   \begin{bmatrix} 3-i \\ 1  \end{bmatrix}
\end{equation*}

Which means the eigenvector for the other eigenvalue is the conjugate of this vector, $v_2=\begin{bmatrix} 3+i \\ 1  \end{bmatrix}$.

Now we use Euler's formula:
$$e^{it} \begin{bmatrix} 3-i \\ 1  \end{bmatrix} = \left(\cos{(t)}+i\sin{(t)}\right)\begin{bmatrix} 3-i \\ 1 \end{bmatrix} $$

$$\begin{bmatrix} (3-i)\cos{t}+(3i+1)\sin{t} \\ \cos{t}+i\sin{t} \end{bmatrix}=  
\begin{bmatrix} 3\cos{t}+\sin{t} \\ \cos{t} \end{bmatrix} +i\begin{bmatrix} 3\sin{t}-\cos{t}\\ \sin{t} \end{bmatrix}$$


Having found our real and imaginary parts, we can now write our general solution as a linear combination of them:
\begin{tcolorbox}[colback=white, title=Solution]
$$X=C_1 \begin{bmatrix} 3\cos{t}+\sin{t} \\ \cos{t} \end{bmatrix}+
C_2 \begin{bmatrix} 3\sin{t}-\cos{t}\\ \sin{t} \end{bmatrix} $$
\end{tcolorbox}

\begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Check solution]

\begin{align*}
x'&=-3C_1\sin{t}+C_1\cos{t}+3C_2 \cos{t}+C_2\sin{t} \\
  &= -3(3C_1\cos{t}+C_1\sin{t}+3C_2\sin{t}-C_2\cos{t})+ 10(C_1 \cos{t}+C_2\sin{t}) \\
  &= -3x+10y
\end{align*}

\begin{align*}
y'&=-C_1\sin{t}+C_2 \cos{t} \\
  &= -(3C_1\cos{t}+C_1\sin{t}+3C_2\sin{t}-C_2\cos{t})+ 3(C_1 \cos{t}+C_2\sin{t}) \\
  &= -x+3y
\end{align*}
\end{tcolorbox}

Purely imaginary complex eigenvalues give a center. Testing points with our original matrix reveals a clockwise direction of rotation.  


```{r, echo=FALSE, message=FALSE, warning=FALSE,fig.keep="last"}
y1<- matrix(c(0, 1, 
              10, 4,
              -6, 10,
              30, 10,
              40, 15),
          5, 2, byrow = TRUE)

y1_df <- tibble(x=c(0,10,-6,30,40), 
                y=c(1,4,10,10,15),
                IC=c("V1", "V2", "V3", "V4", "V5")) %>% 
  mutate(pt = paste0("(",x, ",", y, ")"))

traj8<- trajectory(fun_traj,
           y0         = y1,
           tlim       = c(0, 10),
           parameters = c(-3, 10, -1, 3), add = FALSE)

t8 <- c(traj8$t)
x8 <- as_tibble(traj8$x) %>% bind_cols("t"=t8) %>% 
  pivot_longer(cols = c(1:5), names_to = "IC", values_to = "x")
y8 <- as_tibble(traj8$y) %>% bind_cols("t"=t8) %>% 
  pivot_longer(cols = c(1:5), names_to = "IC", values_to = "y")
z8 <- left_join(x8,y8, by = join_by(t, IC)) %>% filter(x<50 & x>-50 & y<40 & y>-40) %>% 
  left_join(y1_df %>% select(IC, pt), by="IC")

p8 <- phaseplane(fun_plane, x_var="x" ,y_var="y",
           x_window = c(-50, 50), y_window = c(-40, 40),
           parameters = c(a=-3, b=10, c=-1, d=3))

p8+theme_bw()+
  geom_path(data=z8 %>% filter(pt!="(-6,10)"), aes(x=x, y=y, color=pt), linewidth=1.5)+
  geom_point(data=y1_df%>% filter(pt!="(-6,10)"), aes(x=x,y=y, color=pt), shape=21, fill="white",size=4, stroke=2)+labs(color="IC")
```



